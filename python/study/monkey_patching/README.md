# 猴子补丁

https://blog.csdn.net/u013391094/article/details/127530177

## 1、简介
"Monkey patch"（猴子补丁）一词的来源可以追溯到计算机编程领域。它起源于Python编程语言的社区，但现在已经成为一个通用的编程术语。

"Monkey patch"一词中的"monkey"（猴子）指的是在运行时修改或扩展现有代码的能力，类似于猴子在树上随意移动的行为。"Patch"（补丁）则表示对现有代码进行修补或修改。

这个术语的使用源于Python语言的灵活性和动态特性。在Python中，可以在运行时动态地修改类、对象或模块的行为，这种能力被称为"monkey patching"。通过monkey patching，开发人员可以在不修改原始代码的情况下，向现有的类或对象添加新的方法、属性或修改现有的行为。

尽管monkey patching在某些情况下可以解决问题或提供临时的解决方案，但它也可能导致代码的可读性和可维护性下降。因此，在使用monkey patching时需要谨慎，并确保清楚地理解其潜在影响。

## 2、为什么叫这个名字
"Monkey patch"（猴子补丁）一词的名称来源于一个比喻，即在运行时修改或扩展现有代码的能力类似于猴子在树上随意移动的行为。

猴子是一种灵活、机智和适应性强的动物，它们可以在树上自由地移动和探索。同样地，通过monkey patching，开发人员可以在运行时动态地修改类、对象或模块的行为，以适应不同的需求和情况。

"Patch"（补丁）一词则表示对现有代码进行修补或修改。在软件开发中，补丁通常用于修复程序中的错误或漏洞，或者添加新的功能。通过monkey patching，开发人员可以在不修改原始代码的情况下，向现有的类或对象添加新的方法、属性或修改现有的行为，就像在现有代码上打补丁一样。

因此，"Monkey patch"这个术语的名称是一个形象生动的比喻，用于描述在运行时动态修改代码的能力。

## 3、例子1
代码见：D:\Github\Storage\python\study\monkey_patching\example1
这个例子的结论：
我们可以自己定义一个新的方法(或者函数)来更改掉原来类的方法
替换以后，原来类的方法名称还在，但是它的内存地址已经发生变化了
调用的时候，只能使用原来的方法名来调用，而不是新的方法名称
新的方法名称只是包含了实现过程，对于类本身，是看不到这个方法名称的。

## 4、其他对象使用猴子补丁

### 4-1、使用猴子补丁修复类的实例
上面使用了猴子补丁来修复了一个类的方法， 那么该类的所有实例使用该方法的时候都将使用的是修补后的方法。
如果我们想要减少影响，只修补特定的实例对象， 可是可以完成的，代码如下：D:\Github\Storage\python\study\monkey_patching\example2

这个例子的结论：
同一个类的两个实例中，我们可以单独给某一个实例打猴子补丁，而完全不影响另外一个实例

### 4-2、其他对象使用猴子补丁
我们还可以对其他的对象使用猴子补丁，比如模块等， 这里有一个比较实用的例子:

比如你的一个项目中，很多python文件中都用到了import json，后来发现如果使用ujson性能会更高, 但是觉得把每个文件的 import json 都改成 import ujson as json 成本较高(不要光想着替换，很多项目不仅仅有你一个开发人员); 或者仅仅想测试一下用ujson替换json是否符合预期

对于这种需求，只需要在程序的主入口处加上下面的代码：D:\Github\Storage\python\study\monkey_patching\example3

## 5、使用场景与注意事情
可以看到猴子修补非常强大，几乎可以在任何地方修改原来类的实现或者对象的原有功能。但是恰恰是由于其可以随时随地修改，会造成某个对象的具体功能是在哪儿实现的这点非常不明确(破环封装)，这会严重影响程序的鲁棒性，容易引发不必要的Bug。 所以要慎用！

猴子补丁合适的使用场景：
我们正在处理来自其他人的写的公共代码，优化了一个小的实现，我们目前不想对其源码进行修改（因为其他人还有可能在用这些代码，或者其他版本中有可能用到），我可以将这个补丁放在自己的代码中，即保证了功能的实现，也不影响别人实现
我们正在处理来自其他人的遗留代码或代码，我们不想对其进行广泛修改，但仍然希望使其与不同版本的库或环境一起运行，这非常有用。

因此，对于猴子补丁，我个人建议：
- 如果代码的影响范围可控，不要使用猴子补丁，直接更改原来方法的实现
- 如果要使用猴子补丁，尽量在最终端的类或者实例中，不要在中间类中使用